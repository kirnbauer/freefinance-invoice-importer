# ğŸ§¾ FreeFinance ZUGFeRD / XRechnung Importer

Ein CLI-Tool zum automatisierten Import von Ausgangsrechnungen im ZUGFeRD-Format in die FreeFinance-API (AT).  
Es extrahiert eingebettete XML-Dateien aus PDF-Rechnungen, parst die Inhalte und importiert jede Position korrekt als Ausgangsbeleg.  
Kunden werden automatisch erkannt oder neu angelegt.

---

## âœ… Voraussetzungen

- Python 3.8+
- [`pdfdetach`](https://poppler.freedesktop.org/) (aus dem `poppler-utils`-Paket)

### ğŸ”§ Installation (Linux/Mac)

```bash
sudo apt install poppler-utils
pip install -r requirements.txt
```

### ğŸ“¦ Installation (Windows)

1. [Poppler fÃ¼r Windows](https://github.com/oschwartz10612/poppler-windows/releases/) herunterladen
2. Entpacken und den `bin/`-Ordner zur `PATH`-Umgebungsvariable hinzufÃ¼gen
3. In der Konsole prÃ¼fen: `pdfdetach --version`
4. Python-AbhÃ¤ngigkeiten installieren:

```bash
pip install -r requirements.txt
```

---

## âš™ï¸ Konfiguration

1. `config.py.example` nach `config.py` kopieren
2. Zugangsdaten und Pfade eintragen:

```python
from pathlib import Path

USERNAME = "dein-benutzername"
PAIRING_CODE = "dein-pairing-code"
CLIENT_ID = "deine-client-id"
API_URL = "https://app.freefinance.at"

PDF_INPUT_FOLDER = Path("./invoices")
XML_OUTPUT_FOLDER = Path("./output_xml")
DONE_FOLDER = PDF_INPUT_FOLDER / "done"
ERROR_FOLDER = PDF_INPUT_FOLDER / "error"

CUSTOMER_NUMBER_PREFIX = "ext"
```

---

## ğŸ“‚ Ordnerstruktur

- `invoices/` â†’ Hier legst du deine ZUGFeRD-PDFs ab
- `output_xml/` â†’ Extrahierte XML-Dateien
- `invoices/done/` â†’ Erfolgreich verarbeitete PDFs & XMLs
- `invoices/error/` â†’ UngÃ¼ltige oder fehlerhafte Dateien

Die Ordner werden bei Bedarf automatisch erstellt.

---

## â–¶ï¸ Nutzung

```bash
python3 main.py
```

Ablauf:
1. Alle PDF-Dateien in `invoices/` werden durchsucht
2. Eingebettete XML (`xrechnung.xml`) wird extrahiert
3. Rechnungsdaten werden geparst und an FreeFinance gesendet
4. Nach erfolgreichem Import wird die Datei verschoben (PDF + XML)

---

## ğŸ’¡ Features

- âœ… Automatische Extraktion von ZUGFeRD-/XRechnung-XMLs
- âœ… VollstÃ¤ndige Verarbeitung von Rechnungspositionen
- âœ… Intelligente Steuer- und Konto-Zuordnung (z.â€¯B. 20â€¯%, 0â€¯% Reverse Charge)
- âœ… KundenprÃ¼fung & -anlage anhand von `CUSTOMER_NUMBER_PREFIX` + Kundennummer
- âœ… Schutz vor doppeltem Import
- âœ… Logging fÃ¼r XML, Fehler und FreeFinance-Statusmeldungen

---

## ğŸ›  Beispiel: Rechnung mit 2 Positionen

- **PDF:** `invoices/RE1234.pdf`
- **XML wird extrahiert als:** `output_xml/RE1234.xml`
- **FreeFinance bekommt:** 1 Ausgangsrechnung mit 2 Positionen
- **Nach dem Import:** PDF & XML â†’ `invoices/done/`

---

## ğŸ§ª Testumgebung & API-Zugang

Um das System mit FreeFinance zu verbinden, benÃ¶tigst du einen **API-Key** sowie ggf. Zugang zum Testsystem.  
Diesen bekommst du **nicht automatisch**, sondern **nach Kontaktaufnahme mit FreeFinance**.

â¡ï¸ Beantrage deinen API-Zugang Ã¼ber das Kontaktformular auf  
ğŸ”— [https://developer.freefinance.at/](https://developer.freefinance.at/)

Nach der Anfrage erhÃ¤ltst du alle weiteren Informationen sowie ggf. Zugang zum Testsystem.

ğŸ“š **Offizielle API-Dokumentation:**  
[https://developer.freefinance.at/apidoc-1_1.html](https://developer.freefinance.at/apidoc-1_1.html)

---

## âš ï¸ Haftungsausschluss & rechtlicher Hinweis

Dieses Tool wurde unabhÃ¤ngig entwickelt und steht **in keiner Verbindung zur FreeFinance / Manubu GmbH**.  
Es nutzt Ã¶ffentlich dokumentierte Schnittstellen von FreeFinance **zum automatisierten Import von Ausgangsrechnungen in das FreeFinance-System**.

ğŸ›‘ **Die Nutzung dieses Tools erfolgt auf eigene Verantwortung.** ğŸ›‘


- âš ï¸ FÃ¼r die Nutzung dieses Tools wird **keinerlei Haftung Ã¼bernommen** â€“ insbesondere **nicht fÃ¼r Datenverluste, Fehlbuchungen, rechtliche Folgen oder sonstige SchÃ¤den**, die direkt oder indirekt aus dem Einsatz entstehen.
- ğŸ”’ Vor dem Einsatz in einer **produktiven Umgebung** ist eine **ausfÃ¼hrliche PrÃ¼fung und Testphase** unbedingt erforderlich.
- ğŸ“‘ Die Verantwortung fÃ¼r die Richtigkeit der importierten Daten und die Einhaltung gesetzlicher Vorgaben liegt vollstÃ¤ndig beim Anwender.

**Verwende dieses Tool nur, wenn dir die Funktionsweise und mÃ¶glichen Folgen vollstÃ¤ndig klar sind.**

